(this["webpackJsonpmatytermind-frontend"]=this["webpackJsonpmatytermind-frontend"]||[]).push([[0],[,,,,function(e,n,t){},function(e,n,t){},,function(e,n,t){e.exports=t(21)},,,,,function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){},function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),s=t(6),o=t.n(s),i=(t(12),t(13),t(2)),u=t(1),c={pins:4,colours:6,lines:10},l=Array.from({length:c.pins},(function(){return-1})),m={id:"",settings:c,actualGuess:l.map((function(e){return e})),actualLine:0,changeGuess:function(e){m.actualGuess=e},nextLine:function(){m.actualLine++,m.actualGuess=l.map((function(e){return e}))},setId:function(e){m.id=e}},d=a.a.createContext(m);t(14),t(15);function p(){window.location.reload()}var f=a.a.memo((function(e){var n=e.playerWon,t=e.lessLine,r=e.error,s=e.isLoaded;return a.a.createElement("div",{className:"header"},r&&"".concat(r.message),!s&&"Loading...",n&&a.a.createElement("div",{className:"button",onClick:function(){return p()}},"Congratulations! ",a.a.createElement("br",null),"You won!",a.a.createElement("br",null),"Do you want to play again?"),!n&&!t&&a.a.createElement("div",{className:"button",onClick:function(){return p()}},"You lost :( ",a.a.createElement("br",null),"Do you want to try again?"))}),(function(e,n){return e.playerWon===n.playerWon&&e.lessLine===n.lessLine&&e.isLoaded===n.isLoaded&&e.error===n.error})),g=(t(16),a.a.memo((function(){return a.a.createElement("footer",null,a.a.createElement("p",null,"Free logic game based on ",a.a.createElement("a",{href:"https://en.wikipedia.org/wiki/Mastermind_(board_game)"},"Mastermind"),"."),a.a.createElement("p",null,"Implemented by ",a.a.createElement("a",{href:"http://budavariam.github.io"},"M\xe1ty\xe1s Budav\xe1ri")))}),(function(){return!0}))),v=(t(17),t(4),a.a.memo((function(e){return a.a.createElement("div",{className:"pin smallpin smallpin-".concat(e.pinId)})}),(function(e,n){return e.pinId===n.pinId}))),E=(t(5),t(18),a.a.memo((function(e){return a.a.createElement("div",{className:"pin hugepin hugepin-".concat(e.pinId," ").concat(e.marked?"marked":""),onClick:e.onClick})}),(function(e,n){return e.pinId===n.pinId}))),h=(t(19),function(e){var n=Object(r.useState)({pinId:e.pinId}),t=Object(u.a)(n,2),s=t[0],o=t[1];return a.a.createElement(d.Consumer,null,(function(n){var t=n.actualGuess,r=n.changeGuess,i=n.settings;return a.a.createElement("details",{open:e.open,onClick:function(n){e.changeSelector(e.pinIndex),n.preventDefault()}},a.a.createElement("summary",null,a.a.createElement(E,{pinId:s.pinId})),a.a.createElement("div",{className:"pinselector"},Array.from({length:i.colours}).map((function(n,i){return a.a.createElement(E,{key:"".concat(e.pinId,"-").concat(i),pinId:i,marked:i===s.pinId,onClick:function(){return function(n,t,r){o({pinId:n}),t[e.pinIndex]=n,r(t)}(i,t,r)}})}))))}))}),y=function(e){var n=Object(r.useState)({openedSelectorNr:-1}),t=Object(u.a)(n,2),s=t[0],o=t[1];return a.a.createElement("div",{className:"guess"},e.actual?e.pins.map((function(e,n){return a.a.createElement(h,{pinId:e,key:"actual-".concat(n),pinIndex:n,open:s.openedSelectorNr===n,changeSelector:function(e){o((function(n){return{openedSelectorNr:e!==n.openedSelectorNr?e:-1}}))}})})):e.pins.map((function(e,n){return a.a.createElement(E,{pinId:e,key:"".concat(n,"-").concat(e)})})))},b=a.a.memo((function(e){return a.a.createElement("div",{className:"line ".concat(e.actual?"actual":"")},a.a.createElement(y,{actual:e.actual,pins:e.pins}),a.a.createElement("div",{className:"results"},e.actual?a.a.createElement("div",{className:"submit"},e.submitInProgress?a.a.createElement("div",{className:"spinner"}):a.a.createElement("div",{className:"button",onClick:function(){return e.submitGuess()}},"OK")):a.a.createElement("div",{className:"sent"},e.results.map((function(e,n){return a.a.createElement(v,{pinId:e,key:"".concat(n,"-").concat(e)})})))))}),(function(e,n){var t=n.results.every((function(e){return 0===e}))&&n.pins.every((function(e){return-1===e})),r=e.results===n.results&&e.pins===n.pins;return n.actual?r&&e.submitInProgress===n.submitInProgress:r||t})),I=(t(20),a.a.memo((function(e){return a.a.createElement("div",{className:"line"},a.a.createElement("div",{className:"solution ".concat(e.isOver?"":"hidden-solution")},a.a.createElement(y,{pins:e.solution?e.solution:l.map((function(e){return e})),actual:!1})),a.a.createElement("div",{className:"results"}))}),(function(e,n){return e.isOver===n.isOver}))),O=function(e){var n=e.lines.map((function(n,t){return a.a.createElement(b,{key:t,pins:n.guess,results:n.result,actual:!e.isOver&&t===e.actualLine,submitInProgress:e.submitInProgress,submitGuess:e.submitGuess})}));return a.a.createElement("div",{className:"playarea"},a.a.createElement(I,{isOver:e.isOver,solution:e.solution}),n)};function L(e){return Array.from({length:e.pins},(function(){return Math.floor(Math.random()*e.colours)}))}var N={local:{secret:[-1,-1,-1,-1],guesses:[],isOver:!1}},P={colours:6,pins:4,lines:10};var w=!Object({NODE_ENV:"production",PUBLIC_URL:"/matytermind",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_LOCAL_GAME||!1,C=function(){var e=Object(r.useContext)(d),n=Object(r.useReducer)((function(e,n){return Object(i.a)(Object(i.a)({},e),n)}),{error:null,isLoaded:!1,submitInProgress:!1,lines:function(e){var n={guess:l.map((function(e){return e})),result:Array.from({length:e.pins},(function(){return 0}))};return Array.from({length:e.lines},(function(){return n}))}(c),playerWon:!1,solution:null}),t=Object(u.a)(n,2),s=t[0],o=t[1];Object(r.useEffect)((function(){(w?fetch("/api/start").then((function(e){return e.json()})):(N.local={secret:L(P),guesses:[],isOver:!1},Promise.resolve({id:"local",settings:P}))).then((function(n){e.setId(n.id),o({type:"LOADED",isLoaded:!0})}),(function(e){console.error(e),o({type:"LOADED",isLoaded:!0,error:{message:"There was an error during server request, sorry for the inconvenience :("}})}))}),[]);var m=function(n,t){for(var r=[],a=0;a<t.goodGuess;a++)r.push(1);for(var s=0;s<t.goodColour;s++)r.push(2);for(;r.length<e.settings.pins;)r.push(0);return n[e.actualLine]={guess:e.actualGuess.map((function(e){return e})),result:r},e.nextLine(),n},p=s.error,v=s.isLoaded,E=s.submitInProgress,h=e.actualLine<e.settings.lines;return a.a.createElement("div",{className:"game"},a.a.createElement(f,{lessLine:h,playerWon:s.playerWon,error:p,isLoaded:v}),v&&a.a.createElement(O,{submitInProgress:E,submitGuess:function(){if(e.actualGuess.some((function(n){return n<0||n>e.settings.colours})))o({type:"LOADED",isLoaded:!0,error:{message:"Please fill each slot!"}});else{o({type:"SUBMITING",submitInProgress:!0});var n={id:e.id,guess:e.actualGuess};(w?fetch("/api/guess",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})):function(e){if(!e.length||e.some((function(e){return!isFinite(e)||isNaN(e)||e>P.colours||e<0})))throw new Error("Invalid parameters");var n=N.local;if(!n)throw new Error("Game has not started");var t=n.secret;if(n.isOver)throw new Error("Game has already finished");var r=function(e,n,t){var r=n.reduce((function(e,n,r){return e+(n===t[r]?1:0)}),0),a=t.map((function(e,t){return{secretP:n[t],guessP:e}})).filter((function(e){return e.guessP!==e.secretP})).reduce((function(e,n){return e.secretHistogram[n.secretP]=e.secretHistogram[n.secretP]?e.secretHistogram[n.secretP]+1:1,e.guesslist.push(n.guessP),e}),{secretHistogram:{},guesslist:[]}),s=a.guesslist,o=a.secretHistogram;return{goodGuess:r,goodColour:s.reduce((function(e,n){return o[n]&&(e++,o[n]--),e}),0),playerWon:r===e.pins}}(P,t,e),a=r.goodGuess,s=r.goodColour,o=r.playerWon;n.guesses.push({guess:e,evaluation:{goodGuess:a,goodColour:s,playerWon:o}});var i=n.guesses.length>=P.lines;n.isOver=o||i;var u={goodGuess:a,goodColour:s,playerWon:o,solution:n.isOver?t:void 0};return Promise.resolve(u)}(n.guess)).then((function(e){e.message?o({type:"LOADED",isLoaded:!0,error:{message:e.message}}):o({type:"NEXT_STEP",playerWon:e.playerWon,lines:m(s.lines,e),solution:e.solution?e.solution:null,error:null})}),(function(e){console.error(e),o({type:"LOADED",isLoaded:!0,error:{message:"There was an error during server request, sorry for the inconvenience :("}})})).then((function(){return o({type:"SUBMITING",submitInProgress:!1})}))}},lines:s.lines,isOver:s.playerWon||!s.playerWon&&!h,solution:s.solution,actualLine:e.actualLine}),a.a.createElement(g,null))},G=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(d.Provider,{value:m},a.a.createElement(C,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[7,1,2]]]);
//# sourceMappingURL=main.d4fcba0d.chunk.js.map